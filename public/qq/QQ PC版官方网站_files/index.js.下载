!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("AegisReport",[],t):"object"==typeof exports?exports.AegisReport=t():e.AegisReport=t()}(window,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){e.exports=function(){"use strict";var e,t;function n(t){this.name="__st"+(1e9*Math.random()>>>0)+e+"__",null!=t&&t.forEach(this.add,this),e+=1}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{configurable:!0,writable:!0,value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var o=arguments[1],i=0;i<n;){var r=t[i];if(e.call(o,r,i,t))return r;i+=1}}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return this.substring(t=!t||t<0?0:+t,t+e.length)===e}}),window.WeakSet||(e=Date.now()%1e9,n.prototype.add=function(e){var t=this.name;return e[t]||Object.defineProperty(e,t,{value:!0,writable:!0}),this},n.prototype.delete=function(e){return!!e[this.name]&&!(e[this.name]=void 0)},n.prototype.has=function(e){return!!e[this.name]},t=n,Object.defineProperty(window,"WeakSet",{value:function(e){return new t(e)}})),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++)if(null!=(o=arguments[n]))for(var o=Object(o),i=Object.keys(Object(o)),r=0,s=i.length;r<s;r++){var a=i[r],c=Object.getOwnPropertyDescriptor(o,a);null!=c&&c.enumerable&&(t[a]=o[a])}return t}});var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},i=function(){return(i=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<n;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,i++)o[i]=r[s];return o}function s(e){try{return encodeURIComponent(decodeURIComponent(e))}catch(t){return e}}l.prototype.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n].callback===t)return n;return-1},l.prototype.on=function(e,t,n){var o;if(void 0===n&&(n=0),this)return(o=this.eventsList[e])||(this.eventsList[e]=[],o=this.eventsList[e]),-1===this.indexOf(o,t)&&o.push({name:e,type:n||0,callback:t}),this},l.prototype.one=function(e,t){this.on(e,t,1)},l.prototype.remove=function(e,t){if(this){var n=this.eventsList[e];if(!n)return null;if(t)return n.length&&(t=this.indexOf(n,t),n.splice(t,1)),this;try{delete this.eventsList[e]}catch(e){}return null}},l.prototype.clear=function(){this.eventsList={}};var a,c=l,u=function(e){if(!e||0===e.length)return"{}";e=Array.isArray(e)?e:[e];var t=Object.keys(e[0]),n={};return t.forEach((function(t){n[t]=e.map((function(e){return e[t]}))})),n.count=e.length,S(n)};function l(){var e=this;this.emit=function(t,n){if(e){var o;if(null!=(i=e.eventsList[t])&&i.length)for(var i=i.slice(),r=0;r<i.length;r++){o=i[r];try{var s=o.callback.apply(e,[n]);if(1===o.type&&e.remove(t,o.callback),!1===s)break}catch(t){throw t}}return e}},this.eventsList={}}function f(e,t){return"number"==typeof e||"string"==typeof e?e:t?a.string:a.number}function p(e,t){return"string"==typeof e?e.split("?")[t?1:0]||"":e}function d(e){return"string"==typeof e&&e.startsWith("//")?"undefined"!=typeof location&&"https:"===location.protocol:/^https/.test(e)}function h(e){return b.some((function(t){return-1!==e.indexOf(t)}))}function g(e,t,n){var o,i;try{if("function"==typeof(null==t?void 0:t.retCodeHandler))return{code:void 0===(r=(i=t.retCodeHandler(e,null==n?void 0:n.url,null==n?void 0:n.ctx)||{}).code)?"unknown":r,isErr:i.isErr};"string"==typeof e&&(e=JSON.parse(e)),"function"==typeof(null==(o=null==t?void 0:t.ret)?void 0:o.join)&&(E=[].concat(t.ret.map((function(e){return e.toLowerCase()}))));var r,s=Object.getOwnPropertyNames(e).filter((function(e){return-1!==E.indexOf(e.toLowerCase())}));return s.length?{code:""+(r=Number(e[s[0]])),isErr:0!==r}:{code:"unknown",isErr:!1}}catch(e){return{code:"unknown",isErr:!1}}}function m(e,t){void 0===t&&(t=3);var n,o,i,r="";return Array.isArray(e)?(r+="[",n=e.length,e.forEach((function(e,o){var i,s;r=(r+="object"==typeof e&&1<t?m(e,t-1):(s="",s+="undefined"==(i=typeof(e=e))||"symbol"==i||"function"==i?"null":"string"==i||"object"==i?'"'+e+'"':e))+(o===n-1?"":",")})),r+="]"):e instanceof Object?(r="{",o=Object.keys(e),i=o.length,o.forEach((function(n,s){var a,c,u;"object"==typeof e[n]&&1<t?r+='"'+n+'":'+m(e[n],t-1):r+=(u="","string"==(c=typeof(a=e[n=n]))||"object"==c?u+='"'+n+'":"'+a+'"':"function"==typeof a?u+='"'+n+'":"function '+a.name+'"':"symbol"==typeof a?u+='"'+n+'":"symbol"':"number"!=typeof a&&"boolean"!=c||(u+='"'+n+'": '+a),u),r+=s===i-1||s<i-1&&void 0===e[o[s+1]]?"":","})),r+="}"):r+=e,r}(X=a=a||{})[X.number=-1]="number",X.string="";var y,v,w,b=["application/octet-stream","application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/ecmascript","application/vnd.mspowerpoint","application/vnd.apple.mpegurl","application/ogg","text/css","text/javascript","image","audio","video"],E=["ret","retcode","code","errcode"],R=function(){var e=new WeakSet;return function(t,n){if(n instanceof Error)return"Error.message: "+n.message+" \n  Error.stack: "+n.stack;if("object"==typeof n&&null!==n){if(e.has(n))return"[Circular "+(t||"root")+"]";e.add(n)}return n}},O=function(e){if("string"==typeof e)return e;try{return e instanceof Error?(JSON.stringify(e,R(),4)||"undefined").replace(/"/gim,""):JSON.stringify(e,R(),4)||"undefined"}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}},S=function(e){if("string"==typeof e)return e;try{return JSON.stringify(e,R())||"undefined"}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}},T=(x.prototype.sourceURL=function(){return this.data.responseURL},x.prototype.status=function(){return Number(this.data.status)},x.prototype.headers=function(){var e=this.data.getAllResponseHeaders().split("\n"),t={};return e.forEach((function(e){var n;e&&(n=(e=e.split(": "))[0],e=e[1].trim(),t[n]=e)})),t},x),P=(L.prototype.sourceURL=function(){return this.data.url},L.prototype.status=function(){return Number(this.data.status)},L.prototype.headers=function(){var e={};return this.data.headers.forEach((function(t,n){e[n]=t})),e},L);function L(e,t){this.type="fetch",this.data=e||{},this.data.response=t}function x(e){this.type="xhr",this.data=e}function C(e,t){var n,o=[],i=e.config;return e.lifeCycle.on("destroy",(function(){o.length=0})),function(r,s){if(Array.isArray(r)?o=o.concat(r):o.push(r),t&&o.length>=t||e.sendNow&&0<o.length)return o=H(o),s(o.splice(0,o.length)),void(n&&clearTimeout(n));n&&clearTimeout(n),n=setTimeout((function(){n=null,0<(o=H(o)).length&&s(o.splice(0,o.length))}),i.delay)}}function I(e,t){return Array.isArray(e)?t(e.map((function(e){return i(i({},e),{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(O).join(" ")})}))):t([i(i({},e),{msg:"string"==typeof e.msg?e.msg:O(e.msg)})])}function k(e){return function(t,n){e.lifeCycle.emit("modifyRequest",t);var o=e.config.modifyRequest;if("function"==typeof o)try{var i=o(t);"object"==typeof i&&"url"in i&&(t=i)}catch(t){console.error(t)}n(t)}}function A(e){return function(t,n){e.lifeCycle.emit("afterRequest",t);var o=e.config.afterRequest;"function"==typeof o&&!1===o(t)||n(t)}}function N(e){if(e&&e.reduce&&e.length)return 1===e.length?function(t,n){e[0](t,n||G)}:e.reduce((function(e,t){return function(n,o){return void 0===o&&(o=G),e(n,(function(e){return null==t?void 0:t(e,o)}))}}));throw new TypeError("createPipeline need at least one function param")}function _(e,t){Object.getOwnPropertyNames(e).forEach((function(n){"function"==typeof e[n]&&"constructor"!==n&&(t?t[n]="sendPipeline"===n?function(){return function(){}}:function(){}:e[n]=function(){})}))}function U(){return void 0!==window.performance&&"function"==typeof performance.clearResourceTimings&&"function"==typeof performance.getEntriesByType&&"function"==typeof performance.now}function j(e,t){function n(o){"pagehide"!==o.type&&"hidden"!==document.visibilityState||(e(o),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))}addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)}function q(e){var t,n;Z.find((function(t){return t.name===e.name}))||(Z.push(e),z||!window.XMLHttpRequest)||(z=!0,t=window.XMLHttpRequest.prototype.send,n=window.XMLHttpRequest.prototype.open,window.XMLHttpRequest.prototype.open=function(){if(this.aegisMethod=arguments[0],this.aegisUrl=arguments[1],this.aegisXhrStartTime=Date.now(),!this.sendByAegis)for(var e=0;e<Z.length;e++){var t=Z[e];try{"function"==typeof t.open&&t.open(this)}catch(e){}}return n.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){if(!this.sendByAegis)for(var e=0;e<Z.length;e++){var n=Z[e];try{"function"==typeof n.send&&n.send(this,arguments[0])}catch(e){}}return t.apply(this,arguments)})}function F(e){var t=Z.findIndex((function(t){return t.name===e.name}));-1!==t&&Z.splice(t,1)}(X=y=y||{}).INFO_ALL="-1",X.API_RESPONSE="1",X.INFO="2",X.ERROR="4",X.PROMISE_ERROR="8",X.AJAX_ERROR="16",X.SCRIPT_ERROR="32",X.IMAGE_ERROR="64",X.CSS_ERROR="128",X.CONSOLE_ERROR="256",X.MEDIA_ERROR="512",X.RET_ERROR="1024",X.REPORT="2048",X.PV="4096",X.EVENT="8192",X.PAGE_NOT_FOUND_ERROR="16384",X.WEBSOCKET_ERROR="32768",(X=v=v||{}).LOG="log",X.SPEED="speed",X.PERFORMANCE="performance",X.OFFLINE="offline",X.WHITE_LIST="whiteList",X.VITALS="vitals",X.PV="pv",X.CUSTOM_PV="customPV",X.EVENT="event",X.CUSTOM="custom",X.SDK_ERROR="sdkError",X.SET_DATA="setData",(X=w=w||{}).production="production",X.gray="gray",X.pre="pre",X.daily="daily",X.local="local",X.test="test",X.others="others";var D,M,H=function(e){return e.filter((function(t,n){return"static"!==t.type||!e.find((function(e,o){return t.url===e.url&&200===t.status&&n<o}))}))},B=function(e){e.level===y.INFO_ALL&&(e.level=y.INFO)},W=function(e){return(Array.isArray(e)?e:[e]).map((function(e){return Object.getOwnPropertyNames(e).reduce((function(t,n){return"ctx"!==n&&(t[n]=e[n]),t}),{level:y.INFO,msg:""})}))},V=function(e){return function(t){return e.sendPipeline([function(t,n){return n({url:e.config.url||"",data:u(W(t)),method:"post",contentType:"application/json",type:v.LOG,log:t,requestConfig:{timeout:5e3},success:function(){var o=e.config.onReport;"function"==typeof o&&t.forEach((function(e){o(e)})),"function"==typeof n&&n([])},fail:function(t){"403 forbidden"===t&&e.destroy()}})}],v.LOG)(t)}},G=function(){},X=(Object.defineProperty(ie.prototype,"__version__",{get:function(){return console.warn("__version__ has discard, please use version"),"1.37.2"},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"LogType",{get:function(){return console.warn("LogType has discard, please use logType"),y},enumerable:!1,configurable:!0}),ie.prototype.init=function(e){this.setConfig(e);for(var t=0;t<ie.installedPlugins.length;t++)try{ie.installedPlugins[t].patch(this)}catch(e){this.sendSDKError(e)}this.lifeCycle.emit("onInited")},ie.prototype.setConfig=function(e){Object.assign(this.config,e);var t=(e=this.config).id,n=e.uin,o=e.version,i=e.ext1,r=e.ext2,s=e.ext3,a=e.aid,c=void 0===(u=e.env)?"production":u,u=e.pageUrl;return e=this.bean.id!==t||this.bean.uin!==n||this.bean.aid!==a,this.bean.id=t||"",this.bean.uin=n||"",this.bean.version=o||"1.37.2",this.bean.aid=a||"",this.bean.env=function(){switch(c){case w.production:case w.gray:case w.pre:case w.daily:case w.local:case w.test:case w.others:return 1;default:return}}()?c:w.others,u&&this.extendBean("from",encodeURIComponent(u)),i&&this.extendBean("ext1",encodeURIComponent(i)),r&&this.extendBean("ext2",encodeURIComponent(r)),s&&this.extendBean("ext3",encodeURIComponent(s)),e&&this.lifeCycle.emit("onConfigChange",this.config),this.config},ie.use=function(e){-1===ie.installedPlugins.indexOf(e)&&e.aegisPlugin&&ie.installedPlugins.push(e)},ie.unuse=function(e){-1!==(e=ie.installedPlugins.indexOf(e))&&ie.installedPlugins.splice(e,1)},ie.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:y.INFO,msg:e};1===e.length&&e[0].msg&&Object.assign(n,i({},e[0]),{level:y.INFO}),this.normalLogPipeline(n)},ie.prototype.infoAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:y.INFO_ALL,msg:e};1===e.length&&e[0].msg&&Object.assign(n,i({},e[0]),{level:y.INFO_ALL}),this.normalLogPipeline(n)},ie.prototype.report=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:y.REPORT,msg:e};1===e.length&&e[0].msg&&Object.assign(n,i({},e[0])),this.normalLogPipeline(n)},ie.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:y.ERROR,msg:e};1===e.length&&e[0].msg&&Object.assign(n,i({},e[0]),{level:y.ERROR}),this.normalLogPipeline(n)},ie.prototype.speedLogPipeline=function(e){throw new Error('You need to override "speedLogPipeline" method')},ie.prototype.reportPv=function(e){var t,n=this;e&&(console.warn("reportPv is deprecated, please use reportEvent"),t=""+Object.getOwnPropertyNames(this.bean).filter((function(e){return"id"!==e})).map((function(e){return e+"="+n.bean[e]})).join("&"),this.sendPipeline([function(o,i){i({url:n.config.url+"/"+e+"?"+t,addBean:!1,type:v.CUSTOM_PV,fail:function(e){"403 forbidden"===e&&n.destroy()}})}],v.CUSTOM_PV)(null))},ie.prototype.reportEvent=function(e){e&&((e="string"==typeof e?{name:e,ext1:this.config.ext1||"",ext2:this.config.ext2||"",ext3:this.config.ext3||""}:e).name?this.eventPipeline(e):console.warn("reportEvent params error"))},ie.prototype.reportTime=function(e,t){if("object"==typeof e)return this.reportT(e);"string"==typeof e?"number"==typeof t?t<0||6e4<t?console.warn("reportTime: duration must between 0 and 60000"):this.submitCustomTime(e,t):console.warn("reportTime: second param must be number"):console.warn("reportTime: first param must be a string")},ie.prototype.reportT=function(e){var t=e.name,n=e.duration,o=void 0===(o=e.ext1)?"":o,i=void 0===(i=e.ext2)?"":i,r=void 0===(r=e.ext3)?"":r;if(e=e.from,"string"==typeof t&&"number"==typeof n&&"string"==typeof o&&"string"==typeof i&&"string"==typeof r){if(!(n<0||6e4<n))return this.submitCustomTime(t,n,o,i,r,void 0===e?"":e);console.warn("reportTime: duration must between 0 and 60000")}else console.warn("reportTime: params error")},ie.prototype.time=function(e){"string"==typeof e?this.timeMap[e]?console.warn("Timer "+e+" already exists"):this.timeMap[e]=Date.now():console.warn("time: first param must be a string")},ie.prototype.timeEnd=function(e){"string"==typeof e?this.timeMap[e]?(this.submitCustomTime(e,Date.now()-this.timeMap[e]),delete this.timeMap[e]):console.warn("Timer "+e+" does not exist"):console.warn("timeEnd: first param must be a string")},ie.prototype.submitCustomTime=function(e,t,n,o,i,r){this.customTimePipeline({name:e,duration:t,ext1:n||this.config.ext1,ext2:o||this.config.ext2,ext3:i||this.config.ext3,from:r||void 0})},ie.prototype.extendBean=function(e,t){this.bean[e]=t},ie.prototype.sendPipeline=function(e,t){var n,o,s,a=this;return N(r([function(e,t){if("number"!=typeof n.config.random&&(console.warn("random must in [0, 1], default is 1."),n.config.random=1),!n.isHidden||!n.isGetSample)if(n.isGetSample)n.isHidden||t(e);else{if(n.isGetSample=!0,Math.random()<n.config.random)return n.isHidden=!1,t(e);n.isHidden=!0}},(s=t,function(e,t){var n=Array.isArray(e),r=n?e:[e],a=(o.lifeCycle.emit("beforeRequest",e),o.config.beforeRequest);(r="function"==typeof a?r.map((function(e){try{var t=a({logs:e,logType:s});return(null==t?void 0:t.logType)===s&&null!=t&&t.logs?t.logs:!1!==t&&e}catch(t){return e}})).filter((function(e){return!1!==e})):r).length&&(r=function(e,t){if(!Array.isArray(e)||e.length<=1)return e;var n=[],o=[];return!(o="string"==typeof t?[t]:t)||o.length<=0||(o.forEach((function(t){e.forEach((function(e){null!=e&&e[t]&&n.push(t)}))})),0<n.length&&(e=e.map((function(e){var t={};return n.forEach((function(e){t[e]=""})),i(i({},t),e)})))),e}(r,["ext1","ext2","ext3","level","trace","tag","seq"]),t(n?r:r[0]))})],e,[k(o=n=this),function(e,t){a.request(e,(function(){for(var n,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];a.failRequestCount=0,t({isErr:!1,result:o,logType:null==e?void 0:e.type,logs:null==e?void 0:e.log}),null!=(n=null==e?void 0:e.success)&&n.call.apply(n,r([e],o))}),(function(){for(var n,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];10<=++a.failRequestCount&&a.destroy(),t({isErr:!0,result:o,logType:null==e?void 0:e.type,logs:null==e?void 0:e.log}),null!=(n=null==e?void 0:e.fail)&&n.call.apply(n,r([e],o))}))},A(this)]))},ie.prototype.send=function(e,t,n){var o=this;return N([k(this),function(e,i){o.request(e,(function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];i({isErr:!1,result:n,logType:e.type,logs:e.log}),null!=t&&t.apply(void 0,n)}),(function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];i({isErr:!0,result:t,logType:e.type,logs:e.log}),null!=n&&n.apply(void 0,t)}))},A(this)])(e)},ie.prototype.request=function(e,t,n){throw new Error('You need to override "request" method')},ie.prototype.sendSDKError=function(e){var t=this;this.sendPipeline([function(e,n){n({url:t.config.url+"?id=1085&msg[0]="+encodeURIComponent(O(e))+"&level[0]=2&from="+t.config.id+"&count=1&version="+t.config.id+"(1.37.2)",addBean:!1,method:"get",type:v.SDK_ERROR,log:e})}],v.SDK_ERROR)(e)},ie.prototype.destroy=function(e){void 0===e&&(e=!1);var t,n,o=ie.instances.indexOf(this);-1!==o&&ie.instances.splice(o,1);for(var i=ie.installedPlugins.length-1;0<=i;i--)try{ie.installedPlugins[i].unpatch(this)}catch(e){this.sendSDKError(e)}if(this.lifeCycle.emit("destroy"),this.lifeCycle.clear(),e)t=this,n=Object.getOwnPropertyDescriptors(t),Object.keys(n).forEach((function(e){n[e].writable&&(t[e]=null)})),Object.setPrototypeOf(this,null);else{for(var r=this;r.constructor!==Object&&_(r,this),r=Object.getPrototypeOf(r););0===ie.instances.length&&(_(o=Object.getPrototypeOf(this).constructor),_(ie))}},ie.version="1.37.2",ie.instances=[],ie.logType=y,ie.environment=w,ie.installedPlugins=[],ie),J=(oe.prototype.patch=function(e){this.canUse(e)&&this.exist(e)&&(this.instances.push(e),this.triggerInit(e),this.triggerOnNewAegis(e))},oe.prototype.unpatch=function(e){-1!==(e=this.instances.indexOf(e))&&(this.instances.splice(e,1),0===this.instances.length&&this.uninstall())},oe.prototype.countInstance=function(){return this.instances.length},oe.prototype.uninstall=function(){var e;null!=(e=null==(e=this.option)?void 0:e.destroy)&&e.apply(this)},oe.prototype.walk=function(e){var t=this;this.instances.forEach((function(n){var o=t.canUse(n);o&&e(n,o)}))},oe.prototype.canUse=function(e){return!(!(e=this.getConfig(e))||"object"!=typeof e)||!!e},oe.prototype.getConfig=function(e){return null==(e=e.config)?void 0:e[this.name]},oe.prototype.exist=function(e){return-1===this.instances.indexOf(e)},oe.prototype.triggerInit=function(e){var t;this.inited||(this.inited=!0,null!=(t=null==(t=this.option)?void 0:t.init)&&t.call(this.option,this.getConfig(e)))},oe.prototype.triggerOnNewAegis=function(e){var t;null!=(t=null==(t=this.option)?void 0:t.onNewAegis)&&t.call(this.option,e,this.getConfig(e))},oe),$=new J({name:"aid",aid:"",init:function(e){try{var t=!0!==e&&e||window.localStorage.getItem("AEGIS_ID");t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),window.localStorage.setItem("AEGIS_ID",t)),this.aid=t}catch(e){}},onNewAegis:function(e){e.bean.aid=this.aid,e.config.aid=this.aid}}),Q=function(e){var t;return e.payload?(t={},Object.keys(e).forEach((function(n){"payload"!==n&&(t[n]=e[n])})),t):e},K=new J({name:"reportAssetSpeed"}),Y=K=new J({name:"reportAssetSpeed",collectCur:0,collectEntryType:"resource",ASSETS_INITIATOR_TYPE:["img","css","script","link","audio","video"],onNewAegis:function(e){var t=this;U()&&(this.collectSuccessLog(e),this.collectFailLog(e),performance.onresourcetimingbufferfull=function(){t.collectCur=0,performance.clearResourceTimings()})},publish:function(e){this.$walk((function(t){t.speedLogPipeline(e)}))},publishMany:function(e,t){for(var n=t.config,o=0,i=e.length;o<i;o++){var r=e[o];-1!==this.ASSETS_INITIATOR_TYPE.indexOf(r.initiatorType)&&-1===r.name.indexOf("cdn-go.cn/aegis/aegis-sdk")&&this.publish(this.generateLog(r,n))}},collectSuccessLog:function(e){var t,n,o=this;"function"==typeof window.PerformanceObserver?(this.publishMany(performance.getEntriesByType(this.collectEntryType),e),(t=new window.PerformanceObserver((function(t){o.publishMany(t.getEntries(),e)}))).observe({entryTypes:[this.collectEntryType]}),e.lifeCycle.on("destroy",(function(){0===K.countInstance()&&t.disconnect()}))):(n=setInterval((function(){var t=performance.getEntriesByType(o.collectEntryType),n=t.slice(o.collectCur);o.collectCur=t.length,o.publishMany(n,e)}),3e3),e.lifeCycle.on("destroy",(function(){0===K.countInstance()&&clearInterval(n)})))},collectFailLog:function(e){function t(e){var t,i;e&&(e=e.target||e.srcElement,t=(null==e?void 0:e.src)||(null==e?void 0:e.href),e=null==e?void 0:e.tagName,!t||"string"!=typeof t||"IMG"===e&&-1<window.location.href.indexOf(t)||(e="function"==typeof(null==(e=o.api)?void 0:e.resourceTypeHandler)?null==(e=o.api)?void 0:e.resourceTypeHandler(t):"",i=performance.getEntriesByType(n.collectEntryType).find((function(e){return e.name===t})),i={url:p(t),status:400,duration:Number(((null==i?void 0:i.duration)||0).toFixed(2)),method:"get",type:e||"static",isHttps:d(t),urlQuery:p(t,!0),domainLookup:0,connectTime:0},n.publish(i)))}var n=this,o=e.config;window.document.addEventListener("error",t,!0),e.lifeCycle.on("destroy",(function(){0===K.countInstance()&&window.document.removeEventListener("error",t,!0)}))},generateLog:function(e,t){var n;return t="function"==typeof(null==(n=t.api)?void 0:n.resourceTypeHandler)?null==(n=t.api)?void 0:n.resourceTypeHandler(e.name):"",{url:p(e.name),method:"get",duration:Number(e.duration.toFixed(2)),status:200,type:t||"static",isHttps:d(e.name),urlQuery:p(e.name,!0),domainLookup:f(e.domainLookupEnd-e.domainLookupStart),connectTime:f(e.connectEnd-e.connectStart)}},collectNotReportedLog:function(e){var t=performance.getEntriesByType(this.collectEntryType),n=t.length;"function"!=typeof window.PerformanceObserver&&this.collectCur!==n&&(t=t.slice(this.collectCur),this.collectCur=n,this.publishMany(t,e,!0))},destroy:function(){this.option.publish=function(){}}}),z=!1,Z=[],ee=!1,te=[],ne=(new J({name:"reportApiSpeed"}),new J({name:"reportApiSpeed",override:!1,onNewAegis:function(e){this.override||(this.override=!0,this.overrideFetch(e.config),this.overrideXhr(e.config))},overrideFetch:function(e){var t,n=this,o={name:this.name,then:function(t,o,i,r){var s,c,u;e.hostUrl&&-1<i.indexOf(e.hostUrl)||(s={url:t.url,isHttps:d(t.url),method:(null==r?void 0:r.method)||"get",duration:o,type:"fetch",status:t.status||0},"fetch"!==(u="function"==typeof(null==(c=e.api)?void 0:c.resourceTypeHandler)?null==(c=e.api)?void 0:c.resourceTypeHandler(t.url):u)&&"static"!==u&&(c=t.headers?t.headers.get("content-type"):"",u=t.ok&&"string"==typeof c&&h(c)?"static":"fetch"),"fetch"===u?t.clone().text().then((function(a){var c=null==(c=e.api)?void 0:c.apiDetail,u=t.status<=0||400<=t.status,l=(f=g(a,e.api,{url:i,ctx:t})).code,f=f.isErr;c=(u?"FETCH_ERROR: "+a+" \n\n":"")+"req url: "+i+" \n                                \nreq method: "+((null==r?void 0:r.method)||"get")+" \n                                \nreq param: "+(c?m(null==r?void 0:r.body):"")+" \n                                \nres duration: "+o+"ms \n                                \nres status: "+(t.status||0)+" \n                                \nres retcode: "+l+"\n                                \nres data: "+(c?a:""),s.payload=new P(t,a),s.ret=l,s.isErr=+f,n.publishNormalLog({msg:c,level:u?y.AJAX_ERROR:f?y.RET_ERROR:y.API_RESPONSE,code:l,ctx:t})})):Object.assign(s,{type:"static",urlQuery:p(t.url,!0),domainLookup:a.number,connectTime:a.number}),n.publishSpeed(s))},catch:function(t,o,i,r){var s;if(!(e.hostUrl&&-1<i.indexOf(e.hostUrl)))throw s={url:i,isHttps:d(i),method:(null==r?void 0:r.method)||"get",duration:o,type:"fetch",status:0},n.publishSpeed(s),s=null==(s=e.api)?void 0:s.apiDetail,o="AJAX_ERROR: "+t+"\n                          \nres status: 0\n                          \nres duration: "+o+"ms\n                          \nreq url: "+i+"\n                          \nreq method: "+((null==r?void 0:r.method)||"get")+"\n                          \nreq param: "+(s?m(null==r?void 0:r.body):""),n.publishNormalLog({msg:o,level:y.AJAX_ERROR,code:-400,ctx:t}),t}},i=(this.hackFetchOptions=o,this.hackFetchOptions);if(te.find((function(e){return e.name===i.name})))throw new Error("name '"+i.name+"' is already in hackFetch option list");te.push(i),!ee&&window.fetch&&(ee=!0,t=window.fetch,window.fetch=function(e,n){void 0===n&&(n={});for(var o="string"==typeof e?e:e.url,i=0;i<te.length;i++){var r=te[i];try{"function"==typeof r.beforeFetch&&r.beforeFetch(o,n)}catch(e){}}var s=Date.now();return t(e,n).then((function(e){for(var t=0;t<te.length;t++){var i=te[t];try{"function"==typeof i.then&&i.then(e,Date.now()-s,o,n)}catch(e){}}return e})).catch((function(e){for(var t=0;t<te.length;t++){var i=te[t];try{"function"==typeof i.catch&&i.catch(e,Date.now()-s,o,n)}catch(e){}}throw e}))})},getRequestType:function(e,t,n){var o;return"fetch"!==(e="function"==typeof(null==(o=e.api)?void 0:o.resourceTypeHandler)?null==(o=e.api)?void 0:o.resourceTypeHandler(n):"")&&"static"!==e&&(o=t.getResponseHeader("content-type"),e=400<=t.status||"string"!=typeof o||!h(o)?"fetch":"static"),e},overrideXhr:function(e){var t=this,n={name:this.name,send:function(n,o){var i=Date.now();n.addEventListener("loadend",(function(){var r,s=n.aegisUrl;if(s&&!(e.hostUrl&&-1<s.indexOf(e.hostUrl))){var c=Date.now()-i,u={url:s,isHttps:d(s),status:n.status||0,method:n.aegisMethod||"get",type:"fetch",duration:c,payload:new T(n)};if("fetch"===t.getRequestType(e,n,s))try{var l=null==(r=e.api)?void 0:r.apiDetail,f=g(n.response,e.api,{url:s,ctx:n}),h=f.code,v=f.isErr,w="req url: "+s+" \n                                \nreq method: "+u.method+" \n                                \nreq param: "+(l?m(o):"")+" \n                                \nres duration: "+c+"ms \n                                \nres status: "+u.status+" \n                                \nres retcode: "+h+"\n                                \nres data: "+(l?m(n.response):"");u.ret=h,u.isErr=+v,t.publishNormalLog({msg:w,level:v?y.RET_ERROR:y.API_RESPONSE,code:h,ctx:n})}catch(r){u.ret="unknown"}else Object.assign(u,{type:"static",urlQuery:p(s,!0),domainLookup:a.number,connectTime:a.number});t.publishSpeed(u)}}))}};this.hackXHROptions=n,q(this.hackXHROptions)},publishSpeed:function(e){var t=this;e.url=p(e.url),this.$walk((function(n){var o=t.$getConfig(n);"fetch"===e.type&&o&&"function"==typeof o.urlHandler?n.speedLogPipeline(i(i({},e),{url:encodeURIComponent(o.urlHandler(e.url,e.payload))})):n.speedLogPipeline(e)}))},publishNormalLog:function(e){this.$walk((function(t){t.normalLogPipeline(e)}))},destroy:function(){var e,t;this.option.publishSpeed=function(){},this.option.publishNormalLog=function(){},this.option.hackXHROptions&&F(this.option.hackXHROptions),this.option.hackFetchOptions&&(e=this.option.hackFetchOptions,-1!==(t=te.findIndex((function(t){return t.name===e.name})))&&te.splice(t,1))}}));function oe(e){this.aegisPlugin=!0,this.name="",this.instances=[],this.inited=!1,e.$walk=this.walk.bind(this),e.$getConfig=this.getConfig.bind(this),this.option=e,this.name=e.name}function ie(e){var t,n,o,i,r,s,a,u,l,f,p,d,h,g,m,w=this;this.isGetSample=!1,this.isHidden=!1,this.config={version:0,delay:1e3,onError:!0,repeat:5,random:1,aid:!0,device:!0,pagePerformance:!0,webVitals:!0,speedSample:!0,onClose:!0,hostUrl:"https://aegis.qq.com",websocketHack:!1,env:"production",url:"",offlineUrl:"",whiteListUrl:"",pvUrl:"",speedUrl:"",customTimeUrl:"",performanceUrl:"",webVitalsUrl:"",eventUrl:"",setDataReportUrl:""},this.isWhiteList=!1,this.lifeCycle=new c,this.bean={},this.normalLogPipeline=N([C(this,5),I,function(e,n){var o=t.config;n(e=e.map((function(e){var t,n=o.maxLength||204800;try{if(!e.msg||e.msg.length<=n)return e;e.msg=null==(t=e.msg)?void 0:t.substring(0,n)}catch(t){e.msg=O(e.msg).substring(0,o.maxLength)}return e})))},(g=(t=this).config,m={},function(e,t){var n="number"==typeof g.repeat?g.repeat:5;if(0===n)return t(e);t(e.filter((function(e){return e.level!==y.ERROR&&e.level!==y.PROMISE_ERROR&&e.level!==y.AJAX_ERROR&&e.level!==y.SCRIPT_ERROR&&e.level!==y.IMAGE_ERROR&&e.level!==y.CSS_ERROR&&e.level!==y.MEDIA_ERROR||(m[e.msg]=m[e.msg]||0,m[e.msg]+=1,!(m[e.msg]>n))})))}),(d=this.lifeCycle.emit,h=this.config,function(e,t){var n,o=h.logCreated;return"function"==typeof o?(n=e.filter((function(e){return!1!==o(e)})),d("beforeWrite",n),t(n)):(d("beforeWrite",e),t(e))}),(p=this,setTimeout((function(){var e=p.config.pvUrl,t=void 0===e?"":e;t&&p.sendPipeline([function(e,n){n({url:t,type:v.PV,fail:function(e){"403 forbidden"===e&&p.destroy()}})}],v.PV)(null)}),100),function(e,t){t(e)}),(l=u=a=!1,f=[],(r=this).lifeCycle.on("onConfigChange",(function(){s&&clearTimeout(s),s=setTimeout((function(){var e,t;!l&&r.config&&(l=!0,e=r.config.whiteListUrl,(t=void 0===e?"":e)&&r.sendPipeline([function(e,n){n({url:t,type:v.WHITE_LIST,success:function(e){u=!0;try{var t=e.data||JSON.parse(e),n=t.retcode,o=t.result,i=void 0===o?{}:o;if(0===n){if(a=i.is_in_white_list,r.isWhiteList=a,i.shutdown)return void r.destroy();0<=i.rate&&i.rate<=1&&(r.config.random=i.rate,r.isGetSample=!1)}r.isWhiteList&&f.length?V(r)(f.splice(0),(function(){})):!r.isWhiteList&&f.length&&(f.length=0);var s=r.config.onWhitelist;"function"==typeof s&&s(a)}catch(e){}},fail:function(e){"403 forbidden"===e&&r.destroy(),u=!0}})}],v.WHITE_LIST)(null),l=!1)}),r.config.uin?50:500)})),r.lifeCycle.on("destroy",(function(){f.length=0})),function(e,t){var n;a||null!=(n=null==(n=r.config)?void 0:n.api)&&n.reportRequest?t(e.concat(f.splice(0)).map((function(e){return B(e),e}))):(n=e.filter((function(e){return e.level!==y.INFO&&e.level!==y.API_RESPONSE?(B(e),!0):(u||(f.push(e),200<=f.length&&(f.length=200)),!1)}))).length&&t(n)}),function(e,t){try{var n=JSON.parse(JSON.stringify(e)),o=(w.lifeCycle.emit("beforeReport",n),w.config.beforeReport);(e="function"==typeof o?e.filter((function(e){return!1!==o(e)})):e).length&&t(e)}catch(e){}},V(this)]),this.eventPipeline=N([C(this,5),(i=this,function(e){i.sendPipeline([function(e,t){var n=e.map((function(e){return{name:e.name,ext1:e.ext1||i.config.ext1||"",ext2:e.ext2||i.config.ext2||"",ext3:e.ext3||i.config.ext3||""}}));t({url:i.config.eventUrl+"?payload="+encodeURIComponent(JSON.stringify(n)),type:v.EVENT,log:e,fail:function(e){"403 forbidden"===e&&i.destroy()}})}],v.EVENT)(e)})]),this.timeMap={},this.failRequestCount=0,this.customTimePipeline=N([C(this,5),(o=this,function(e){return o.sendPipeline([function(e,t){t({url:o.config.customTimeUrl+"?payload="+encodeURIComponent(JSON.stringify({custom:e})),type:v.CUSTOM,log:e,fail:function(e){"403 forbidden"===e&&o.destroy()}})}],v.CUSTOM)(e)})]),this.config=(n=this.config,void 0===(e=e.hostUrl)&&(e="https://aegis.qq.com"),n.url=n.url||e+"/collect",n.offlineUrl=n.offlineUrl||e+"/offline",n.whiteListUrl=n.whiteListUrl||e+"/collect/whitelist",n.pvUrl=n.pvUrl||e+"/collect/pv",n.eventUrl=n.eventUrl||e+"/collect/events",n.speedUrl=n.speedUrl||e+"/speed",n.customTimeUrl=n.customTimeUrl||e+"/speed/custom",n.performanceUrl=n.performanceUrl||e+"/speed/performance",n.webVitalsUrl=n.webVitalsUrl||e+"/speed/webvitals",n.setDataReportUrl=n.SetDataReportUrl||e+"/speed/miniProgramData",n),ie.instances.push(this)}function re(e,t,n,o){return void 0===n&&(n=15e3),void 0===o&&(o=0),(t=void 0===t?0:t)<=e&&e<=n?e:o}(ge=D=D||{})[ge.unknown=100]="unknown",ge[ge.wifi=1]="wifi",ge[ge.net2g=2]="net2g",ge[ge.net3g=3]="net3g",ge[ge.net4g=4]="net4g",ge[ge.net5g=5]="net5g",ge[ge.net6g=6]="net6g",(ge=M=M||{})[ge.android=1]="android",ge[ge.ios=2]="ios",ge[ge.windows=3]="windows",ge[ge.macos=4]="macos",ge[ge.linux=5]="linux",ge[ge.other=100]="other";var se,ae,ce,ue,le,fe,pe,de,he,ge=new J({name:"device",onNewAegis:function(e){e.extendBean("platform",this.getPlatform()),e.extendBean("netType",D.unknown),this.getDpi(e),this.refreshNetworkTypeToBean(e)},getDpi:function(e){e.extendBean("vp",Math.round(window.innerWidth)+" * "+Math.round(window.innerHeight)),window.screen&&e.extendBean("sr",Math.round(window.screen.width)+" * "+Math.round(window.screen.height))},getPlatform:function(){var e={android:/\bAndroid\s*([^;]+)/,ios:/\b(iPad|iPhone|iPod)\b.*? OS ([\d_]+)/,windows:/\b(Windows NT)/,macos:/\b(Mac OS)/,linux:/\b(Linux)/i},t=Object.keys(e).find((function(t){return e[t].test(navigator.userAgent)}));return t?M[t]:M.other},refreshNetworkTypeToBean:function(e){var t=this,n=e.config;n&&("function"==typeof n.getNetworkType?n.getNetworkType:me)((function(n){D[n]||(n=D.unknown),e.extendBean("netType",n),t.NetworkRefreshTimer=setTimeout((function(){t.refreshNetworkTypeToBean(e),clearTimeout(t.NetworkRefreshTimer)}),1e4)}))}}),me=function(e){var t="",n=navigator.userAgent.match(/NetType\/(\w+)/);n?t=n[1]:navigator.connection&&(t=navigator.connection.effectiveType||navigator.connection.type),e((n=t=t||"unknown",0<=(n=String(n).toLowerCase()).indexOf("4g")?D.net4g:0<=n.indexOf("wifi")?D.wifi:0<=n.indexOf("5g")?D.net5g:0<=n.indexOf("6g")?D.net6g:0<=n.indexOf("3g")?D.net3g:0<=n.indexOf("2g")?D.net2g:D.unknown))},ye=window.WebSocket,ve=[],we={construct:function(e,t){var n=new e(t[0],t[1]);return n.originSend=n.send,n.addEventListener("error",(function(e){var t=(e=(null==e?void 0:e.currentTarget)||{}).url,n=e.readyState;null!=ve&&ve.forEach((function(e){null!=(e=e.onErr)&&e({msg:"无法获知具体错误信息，需在浏览器控制台查看！",readyState:n,connectUrl:t})}))})),Object.defineProperty(n,"send",{get:function(){return function(e){null!=(t=n.originSend)&&t.call(n,e);var t=n.readyState,o=(e=WebSocket.OPEN,WebSocket.CLOSED),r=WebSocket.CONNECTING,s=WebSocket.CLOSING;if(t!==e){var a={readyState:t,connectUrl:n.url};switch(t){case o:ve.forEach((function(e){null!=(e=e.sendErr)&&e(i({msg:"消息发送失败，连接已关闭！"},a))}));break;case r:ve.forEach((function(e){(0,e.sendErr)(i({msg:"消息发送失败，正在连接中！"},a))}));break;case s:ve.forEach((function(e){(0,e.sendErr)(i({msg:"消息发送失败，连接正在关闭！"},a))}))}}}}}),n}},be=new J({name:"onError"}),Ee=be=new J({name:"onError",onNewAegis:function(e){this.startListen(e)},startListen:function(e){function t(e){e=e&&O(e.reason),a.publishErrorLog({msg:"PROMISE_ERROR: "+e,level:y.PROMISE_ERROR})}function n(e){if(e=(null==e?void 0:e.target)||(null==e?void 0:e.srcElement)){var t=e.src||e.href;if(e=e.tagName,"string"==typeof t&&e&&!(-1<window.location.href.indexOf(t))){var n={msg:e+" load fail: "+t,level:y.INFO};if(/\.js$/.test(t))n.level=y.SCRIPT_ERROR;else if(/\.css$/.test(t))n.level=y.CSS_ERROR;else switch(e.toLowerCase()){case"script":n.level=y.SCRIPT_ERROR;break;case"link":n.level=y.CSS_ERROR;break;case"img":n.level=y.IMAGE_ERROR;break;case"audio":case"video":n.level=y.MEDIA_ERROR;break;default:return}a.publishErrorLog(n)}}}var o,i,s,a=this,c=window.onerror,u=(window.onerror=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a.publishErrorLog({msg:(O(e[0])||"")+" @ ("+(O(e[1])||"")+":"+(e[2]||0)+":"+(e[3]||0)+")\n          \n"+O(e[4]||""),level:y.ERROR}),null!=c&&c.call.apply(c,r([window],e))},window.addEventListener("unhandledrejection",t),window.document.addEventListener("error",n,!0),e.lifeCycle.on("destroy",(function(){0===be.countInstance()&&(window.document.removeEventListener("unhandledrejection",t),window.document.removeEventListener("error",n,!0))})),this),l={name:this.name,send:function(t,n){t.addEventListener("loadend",(function(){var o,i,r="";this.failType?r=this.failType:this.status?400<=this.status&&(r="error"):r="failed",e.config.hostUrl&&this.aegisUrl&&-1<this.aegisUrl.indexOf(e.config.hostUrl)||(o=null==(o=e.config.api)?void 0:o.apiDetail,r&&(i=t.aegisUrl,i=g(t.response,e.config.api,{url:i,ctx:t}).code,u.publishErrorLog({msg:"AJAX_ERROR: request "+r+"\n                      \nreq url: "+this.aegisUrl+"\n                      \nres status: "+(this.status||0)+"\n                      \nres retcode: "+i+"\n                      \nres duration: "+(Date.now()-t.aegisXhrStartTime)+"ms\n                      \nreq method: "+this.aegisMethod+"\n                      \nreq param: "+(o?m(n):"")+"\n                      \nres data: "+(o?null===(i=(r=t).responseType&&"text"!==r.responseType?"":r.responseText)||void 0===i?void 0:i.slice(0,1e3):""),level:y.AJAX_ERROR,ctx:t})))})),t.addEventListener("timeout",(function(){t.failType="timeout"})),t.addEventListener("error",(function(){t.failType="error"})),t.addEventListener("abort",(function(){t.failType="abort"}))}};this.hackXHROptions=l,q(this.hackXHROptions),e.config.websocketHack&&(l={key:e.config.id+"-"+this.name,onErr:function(e){var t;null!=(t=a.publishWsErrorLog)&&t.call(a,e)},sendErr:function(e){var t;null!=(t=a.publishWsErrorLog)&&t.call(a,e)}},this.hackWebsocketConfig=l,l=this.hackWebsocketConfig,window.Proxy&&window.WebSocket&&(o=window.WebSocket,window&&!o.isHack&&(i=new Proxy(WebSocket,we),o.isHack=!0,window.WebSocket=i),s=l,ve.find((function(e){return e.key===s.key}))||s&&ve.push(s)))},publishErrorLog:function(e){this.$walk((function(t){t.normalLogPipeline(e)}))},publishWsErrorLog:function(e){var t=e.connectUrl,n=e.msg;e=e.readyState,this.publishErrorLog({msg:"WEBSOCKET_ERROR: \n              connect: "+t+"\n              readyState: "+e+"\n              msg: "+n,level:y.WEBSOCKET_ERROR})},destroy:function(){var e,t;this.option.publishErrorLog=function(){},this.option.hackXHROptions&&F(this.option.hackXHROptions),this.option.hackWebsocketConfig&&(e=this.option.hackWebsocketConfig,window.WebSocket=ye,-1!==(t=ve.findIndex((function(t){return t.key===e.key})))&&ve.splice(t,1))}}),Re=(new J({name:"pagePerformance"}),1),Oe=new J({name:"pagePerformance",onNewAegis:function(e){var t=this;if(U())if(se)this.publish(se,e);else try{this.getFirstScreenTiming(e,(function(n){var o=performance.timing;o&&(se={dnsLookup:re(o.domainLookupEnd-o.domainLookupStart),tcp:re(o.connectEnd-o.connectStart),ssl:re(0===o.secureConnectionStart?0:o.requestStart-o.secureConnectionStart),ttfb:re(o.responseStart-o.requestStart),contentDownload:re(o.responseEnd-o.responseStart),domParse:re(o.domInteractive-o.domLoading),resourceDownload:re(o.loadEventStart-o.domInteractive,0,15e3,1070),firstScreenTiming:re(Math.floor(n),0,6e4)},t.publish(se,e))}))}catch(e){}},publish:function(e,t){var n=this;t.sendPipeline([function(e,o){var i,r=[];for(i in e)r.push(i+"="+e[i]);var s,a=n.$getConfig(t);if(a)return s=-1===t.config.performanceUrl.indexOf("?")?"?":"&","function"==typeof a.urlHandler?o({url:t.config.performanceUrl+s+r.join("&")+"&from="+(encodeURIComponent(a.urlHandler())||window.location.href),beanFilter:["from"],type:v.PERFORMANCE,log:e}):o({url:t.config.performanceUrl+s+r.join("&"),type:v.PERFORMANCE,log:e})}],v.PERFORMANCE)(e)},getFirstScreenTiming:function(e,t){e.lifeCycle.on("destroy",(function(){c&&clearTimeout(c)}));var n=["script","style","link","br"],o=[],i=this,r={},s=new MutationObserver((function(e){var t={roots:[],rootsDomNum:[],time:performance.now()};e.forEach((function(e){e&&e.addedNodes&&e.addedNodes.forEach&&e.addedNodes.forEach((function(e){1===e.nodeType&&(e.hasAttribute("AEGIS-FIRST-SCREEN-TIMING")||e.querySelector("[AEGIS-FIRST-SCREEN-TIMING]"))?(Object.prototype.hasOwnProperty.apply(r,[t.time])||(r[t.time]=[]),r[t.time].push(e)):1!==e.nodeType||-1!==n.indexOf(e.nodeName.toLocaleLowerCase())||i.isEleInArray(e,t.roots)||e.hasAttribute("AEGIS-IGNORE-FIRST-SCREEN-TIMING")||(t.roots.push(e),t.rootsDomNum.push(i.walkAndCount(e)||0))}))})),t.roots.length&&o.push(t)})),a=(s.observe(document,{childList:!0,subtree:!0}),function(){var n=0,u=0,l=Object.keys(r).filter((function(e){return r[+e].find((function(e){return i.isInFirstScreen(e)}))}));l.length?(u=Math.max.apply(null,l),("object"!=typeof(null==(l=e.config)?void 0:l.pagePerformance)||null!=(l=e.config.pagePerformance)&&l.firstScreenInfo)&&(e.firstScreenInfo={element:null==(l=r[u])?void 0:l[0],timing:u,markDoms:r})):o.forEach((function(t){for(var o,r=0;r<t.roots.length;r++)t.rootsDomNum[r]>n&&i.isInFirstScreen(t.roots[r])&&(n=t.rootsDomNum[r],u=t.time,("object"!=typeof(null==(o=e.config)?void 0:o.pagePerformance)||null!=(o=e.config.pagePerformance)&&o.firstScreenInfo)&&(e.firstScreenInfo={element:t.roots[r],timing:u}))})),!u&&Re?c=setTimeout((function(){return a()}),3e3):(s.disconnect(),null!=t&&t(u)),--Re}),c=setTimeout((function(){return a()}),3e3)},isEleInArray:function(e,t){return!(!e||e===document.documentElement)&&(-1!==t.indexOf(e)||this.isEleInArray(e.parentElement,t))},isInFirstScreen:function(e){if(!e||"function"!=typeof e.getBoundingClientRect)return!1;e=e.getBoundingClientRect();var t=window.innerHeight,n=window.innerWidth;return 0<=e.left&&e.left<n&&0<=e.top&&e.top<t&&0<e.width&&0<e.height},walkAndCount:function(e){var t=0;if(e&&1===e.nodeType){t+=1;var n=e.children;if(null!=n&&n.length)for(var o=0;o<n.length;o++)t+=this.walkAndCount(n[o])}return t}});function Se(){le=[],ce=-1,ae=null,Le(addEventListener)}function Te(e,t){ae||(ae=t,ce=e,ue=new Date,Le(removeEventListener),Pe())}function Pe(){var e;0<=ce&&ce<ue-pe&&(e={entryType:"first-input",name:ae.type,target:ae.target,cancelable:ae.cancelable,startTime:ae.timeStamp,processingStart:ae.timeStamp+ce},le.forEach((function(t){t(e)})),le=[])}function Le(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,de,fe)}))}function xe(e,t){return{name:e,value:void 0===t?-1:t,delta:0,entries:[],id:"v1-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}}function Ce(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var n=new PerformanceObserver((function(e){return e.getEntries().map(t)}));return n.observe({type:e,buffered:!0}),n}}catch(e){}}function Ie(e){addEventListener("pageshow",(function(t){t.persisted&&e(t)}),!0)}function ke(e,t,n){var o;return function(){0<=t.value&&(n||Fe.has(t)||"hidden"===document.visibilityState)&&(t.delta=t.value-(o||0),!t.delta&&void 0!==o||(o=t.value,e(t)))}}function Ae(){qe((function(e){e=e.timeStamp,De=e}),!0)}function Ne(){return De<0&&((De=self.webVitals.firstHiddenTime)===1/0&&Ae(),Ie((function(){setTimeout((function(){De="hidden"===document.visibilityState?0:1/0,Ae()}),0)}))),{get timeStamp(){return De}}}function _e(e){var t=e.name;e=e.value,Me[t]=e}fe={passive:!0,capture:!0},pe=new Date,de=function(e){var t,n,o,i;function r(){Te(n,o),i()}function s(){i()}e.cancelable&&(t=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(n=t,o=e,i=function(){removeEventListener("pointerup",r,fe),removeEventListener("pointercancel",s,fe)},addEventListener("pointerup",r,fe),addEventListener("pointercancel",s,fe)):Te(t,e))},he="hidden"===document.visibilityState?0:1/0,addEventListener("visibilitychange",(function e(t){"hidden"===document.visibilityState&&(he=t.timeStamp,removeEventListener("visibilitychange",e,!0))}),!0),Se(),self.webVitals={firstInputPolyfill:function(e){le.push(e),Pe()},resetFirstInputPolyfill:Se,get firstHiddenTime(){return he}};var Ue,je,qe=function(e,t){function n(o){"pagehide"!==o.type&&"hidden"!==document.visibilityState||(e(o),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))}addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},Fe=new("function"==typeof WeakSet?WeakSet:Set),De=-1,Me=(new J({name:"webVitals"}),{FCP:-1,LCP:-1,FID:-1,CLS:-1}),He=new J({name:"webVitals",onNewAegis:function(e){if(U()&&"function"==typeof window.PerformanceObserver)try{y=_e,w=Ne(),b=xe("FCP"),E=performance.getEntriesByName("first-contentful-paint")[0],R=E?null:Ce("paint",T),(E||R)&&(v=ke(y,b,void 0),E&&T(E),Ie((function(e){b=xe("FCP"),v=ke(y,b,void 0),requestAnimationFrame((function(){requestAnimationFrame((function(){b.value=performance.now()-e.timeStamp,Fe.add(b),v()}))}))}))),f=_e,h=Ne(),g=xe("LCP"),(m=Ce("largest-contentful-paint",S))&&(p=ke(f,g,void 0),d=function(){Fe.has(g)||(m.takeRecords().map(S),m.disconnect(),Fe.add(g),p())},["keydown","click"].forEach((function(e){addEventListener(e,d,{once:!0,capture:!0})})),qe(d,!0),Ie((function(e){g=xe("LCP"),p=ke(f,g,void 0),requestAnimationFrame((function(){requestAnimationFrame((function(){g.value=performance.now()-e.timeStamp,Fe.add(g),p()}))}))}))),s=_e,a=Ne(),c=xe("FID"),u=Ce("first-input",O),l=ke(s,c,void 0),u&&qe((function(){u.takeRecords().map(O),u.disconnect()}),!0),u||window.webVitals.firstInputPolyfill(O),Ie((function(){c=xe("FID"),l=ke(s,c,void 0),window.webVitals.resetFirstInputPolyfill(),window.webVitals.firstInputPolyfill(O)})),n=_e,i=xe("CLS",0),(r=Ce("layout-shift",t))&&(o=ke(n,i,void 0),qe((function(){r.takeRecords().map(t),o()})),Ie((function(){i=xe("CLS",0),o=ke(n,i,void 0)}))),j(this.publish.bind(this,e),!0)}catch(e){}function t(e){e.hadRecentInput||(i.value+=e.value,i.entries.push(e),o())}var n,o,i,r,s,a,c,u,l,f,p,d,h,g,m,y,v,w,b,E,R;function O(e){e.startTime<a.timeStamp&&(c.value=e.processingStart-e.startTime,c.entries.push(e),Fe.add(c),l())}function S(e){var t=e.startTime;t<h.timeStamp&&(g.value=t,g.entries.push(e)),p()}function T(e){"first-contentful-paint"===e.name&&(R&&R.disconnect(),e.startTime<w.timeStamp&&(b.value=e.startTime,b.entries.push(e),Fe.add(b),v()))}},publish:function(e){e.sendPipeline([function(t,n){var o,i=[];for(o in t)i.push(o+"="+t[o]);var r=-1===e.config.performanceUrl.indexOf("?")?"?":"&";n({url:e.config.webVitalsUrl+r+i.join("&"),type:v.VITALS,log:t,sendBeacon:!0})}],v.VITALS)(Me)},destroy:function(){this.option.publish=function(){}}}),Be=0,We=(o(je=Xe,X=Ue=X),je.prototype=null===X?Object.create(X):(Je.prototype=X.prototype,new Je),Xe.prototype.getBean=function(e){var t=this;return void 0===e&&(e=[]),""+Object.getOwnPropertyNames(this.bean).filter((function(t){return-1===e.indexOf(t)})).map((function(e){return e+"="+t.bean[e]})).join("&")},Xe.prototype.resetRequesting=function(){var e;this.sendNow||(this.requesting=!1,(e=this.requestQueue.shift())&&this.request(e.options,e.success,e.fail))},Xe.prototype.request=function(e,t,n){var o,i=this;if(e&&"string"==typeof e.url&&""!==e.url&&this.bean.id)if(this.sendNow||!this.requesting){this.requesting=!0;var r=e.url,s=(!1!==e.addBean&&(r=r+(-1===r.indexOf("?")?"?":"&")+this.getBean(e.beanFilter)),e.url=r,r=e.method||"get",this.config.onBeforeRequest);if(!(e=s?s(e,this):e))return this.resetRequesting(),console.warn("Sending request blocked");if(!e.url)return this.resetRequesting(),console.warn("Please handle the parameters reasonably, options.url is necessary");if((e.sendBeacon||this.sendNow)&&"function"==typeof navigator.sendBeacon)return this.resetRequesting(),void navigator.sendBeacon(e.url,e.data);var a=new XMLHttpRequest;a.sendByAegis=!0,a.addEventListener("readystatechange",(function(){4===a.readyState&&(i.resetRequesting(),400<=a.status||0===a.status?null!=n&&n(a.response):null!=t&&t(a.response))})),"get"===r.toLocaleLowerCase()?(a.open("get",(s=e.url,o=e.data,"string"!=typeof s?"":"object"==typeof o&&o?(r=Object.getOwnPropertyNames(o).map((function(e){var t=o[e];return e+"="+("string"==typeof t?encodeURIComponent(t):encodeURIComponent(JSON.stringify(t)))})).join("&").replace(/eval/gi,"evaI"),s+(-1===s.indexOf("?")?"?":"&")+r):s)),a.send()):(a.open("post",e.url),e.contentType&&a.setRequestHeader("Content-Type",e.contentType),"string"==typeof e.data&&(e.data=e.data.replace(/eval/gi,"evaI")),a.send(e.data))}else this.requestQueue.push({options:e,success:t,fail:n})},Xe.useAsyncPlugin=function(e,t){var n,o=void 0===(n=(t=void 0===t?{}:t).exportsConstructor)?"aegis-plugin-"+Be:n,i=void 0===(n=t.onAegisInit)?function(){}:n,r=void 0===(n=t.onAegisInitAndPluginLoaded)?function(){}:n;if(Be+=1,"string"!=typeof e)throw new TypeError("useAsyncPlugin first param must be string");if("function"!=typeof i||"function"!=typeof r)throw new TypeError("onAegisInit and onAegisInitAndPluginLoaded must be function");this.use(new J({name:"asyncPlugin",onNewAegis:function(t){try{i(t),Xe.asyncPlugin[e]?r(t,window[Xe.asyncPlugin[e]]):(n=e,s=o,a=function(n){n||(Xe.asyncPlugin[e]=o,n=window[o],r(t,n))},c=document.createElement("script"),u=document.head,"function"==typeof s&&(a=s,s=""),c.src=n,c.setAttribute("name",s),c.name=s,c.setAttribute("crossorigin","anonymous"),c.crossorigin="anonymous",c.defer=!0,c.hasLoaded=!1,c.onreadystatechange=function(){c.hasLoaded||c.readyState&&"loaded"!==c.readyState&&"complete"!==c.readyState||(c.hasLoaded=!0,"function"==typeof a&&a(!1),setTimeout((function(){u.contains(c)&&u.removeChild(c)})))},c.onload=c.onreadystatechange,c.onerror=function(){"function"==typeof a&&a(!0),setTimeout((function(){u.contains(c)&&u.removeChild(c)}))},"complete"===document.readyState?u.appendChild(c):window.addEventListener("load",(function(){u.appendChild(c)})))}catch(n){console.log("error on below is caused by "+e+" "),console.error(n)}var n,s,a,c,u}}))},Xe.prototype.publishPluginsLogs=function(){var e=Xe.installedPlugins.find((function(e){return"reportAssetSpeed"===e.name}));null!=e&&e.option.collectNotReportedLog(this)},Xe.prototype.publishLogsQueue=function(){var e=this;this.sendNow=!0,this.requestQueue.forEach((function(t){t.option&&(t.option=i(i({},t.option),{sendBeacon:!0})),e.request(t)})),this.requestQueue=[]},Xe.prototype.uploadLogs=function(e,t){this.lifeCycle.emit("uploadLogs",e=void 0===e?{}:e,t=void 0===t?{}:t)},Xe.sessionID="session-"+Date.now(),Xe.asyncPlugin={},Xe.urls={aegisCollect:"https://aegis.qq.com/collect",flog:"https://cdn-go.cn/vasdev/web_webpersistance_v2/v1.8.2/flog.core.min.js",shadowLog:""},Xe),Ve=new J({name:"offlineLog"}),Ge=(X=Ve=new J({name:"offlineLog",onNewAegis:function(e){!function(e,t){function n(e){u=e}function o(e){a=a.concat(e)}function r(e,t){c={conds:e=void 0===e?{}:e,params:t=void 0===t?{}:t}}var a=[],c=null,u=null;We.useAsyncPlugin(e,{exportsConstructor:"Flog",onAegisInit:function(e){e.lifeCycle.on("beforeWrite",o),e.lifeCycle.on("uploadLogs",r),e.lifeCycle.on("onConfigChange",n)},onAegisInitAndPluginLoaded:function(e,l){var f,p,d,h,g,m,w=void 0===(w=t.dbConfig)?{}:w,b=void 0===(b=t.url)?We.urls.aegisCollect:b,E=void 0===(E=t.offlineLogExp)?3:E,R=t.id,S=t.uin;null!=(f=e.lifeCycle)&&f.remove("beforeWrite",o),null!=(f=e.lifeCycle)&&f.remove("uploadLogs",r),null!=(f=e.lifeCycle)&&f.remove("onConfigChange",n),b=Object.assign({lookupUrl:b+"/offlineAuto?id="+R,preservedDay:E,id:R,uin:S,aid:(null==(f=e.bean)?void 0:f.aid)||"",beforeRequest:e.config.beforeRequest,afterRequest:e.config.afterRequest},w,{sessionId:We.sessionID});try{var T=new l(b);a.forEach((function(e){T.add(i(i({},e),{level:e.level===y.INFO_ALL?y.INFO:e.level}))})),null!=(p=e.lifeCycle)&&p.on("beforeWrite",(function(e){(e=void 0===e?[]:e).forEach((function(e){T.add(i(i({},e),{level:e.level===y.INFO_ALL?y.INFO:e.level}))}))})),null!=(d=e.lifeCycle)&&d.on("uploadLogs",(function(n,o){var i;void 0===n&&(n={}),void 0===o&&(o={}),T.uploadLogs(Object.assign({id:t.id,uin:t.uin,aid:null==(i=e.bean)?void 0:i.aid},n),o)})),null!=(h=e.lifeCycle)&&h.on("onConfigChange",(function(e){T.setConfig(e)})),null!=(g=e.lifeCycle)&&g.on("destroy",(function(){0===Ve.countInstance()&&(a.length=0,"function"==typeof((c=null)==T?void 0:T.destroy)&&T.destroy())})),T.on("PERREVENT",(function(n){e.sendPipeline([function(e,n){o={msg:O(e),level:y.INFO};var o=(o=Array.isArray(o)?o:[o]).map((function(e,t){return Object.getOwnPropertyNames(e).map((function(n){return s(n)+"["+t+"]="+(void 0===e[n]?"":s(e[n]))})).join("&")})).join("&")+(o.length?"&count="+o.length:"");n({type:v.OFFLINE,data:o,contentType:"application/x-www-form-urlencoded",method:"post",addBean:!1,url:t.url+"?id=893&sessionId="+We.sessionID+"&uin="+t.uin+"&from="+t.id+"&count=1&version=1.37.2",log:e})}],v.OFFLINE)(n)})),u&&(T.setConfig(u),u=null),c&&(null!=(m=e.lifeCycle)&&m.emit("uploadLogs",c.conds,c.params),c=null),e.flog=T}catch(e){console.log(e)}}})}(We.urls.flog,e.config)}}),new J({name:"spa"}),new J({name:"spa",init:function(){history.pushState=this.wr("pushState")||history.pushState,history.replaceState=this.wr("replaceState")||history.replaceState;var e=(null==(e=location.href)?void 0:e.split("?"))[0];this.$fireUrl=e,this.sendPv=this.sendPv.bind(this),this.onPageChange()},onPageChange:function(){window.addEventListener("replaceState",this.sendPv),window.addEventListener("pushState",this.sendPv),window.addEventListener("popstate",this.sendPv)},wr:function(e){var t=history[e];return"function"==typeof t&&!history.__hasWrittenByTamSpa&&(Object.defineProperty(history,"__hasWrittenByTamSpa",{value:!0,enumerable:!1}),function(){var n=t.apply(this,arguments),o=null;return"function"==typeof Event?o=new Event(e):(o=document.createEvent("HTMLEvents")).initEvent(e,!1,!0),window.dispatchEvent(o),n})},sendPv:function(){var e=this;setTimeout((function(){var t=location.href,n=(null==(n=location.href)?void 0:n.split("?"))[0];n&&n!==e.$fireUrl&&(e.$walk((function(e){e.sendPipeline([function(n,o){o({url:e.config.pvUrl+"?from="+encodeURIComponent(t),beanFilter:["from"],type:v.PV})}],v.PV)(null)})),e.$fireUrl=n)}),0)},destroy:function(){window.removeEventListener("replaceState",this.option.sendPv),window.removeEventListener("pushState",this.option.sendPv),window.removeEventListener("popstate",this.option.sendPv)}}));function Xe(e){var t,n,o,r,s,a=Ue.call(this,e)||this;a.sendNow=!1,a.requestQueue=[],a.requesting=!1,a.speedLogPipeline=N([C(a),(r=a.config,s={},function(e,t){var n,o;r.speedSample?(o="object"==typeof r.repeat?r.repeat:{repeat:r.repeat},n=+o.speed||+o.repeat||5,Array.isArray(e)?(o=e.filter((function(e){var t=!s[e.url]||s[e.url]<n;return s[e.url]=1+~~s[e.url],t}))).length&&t(o):(!s[e.url]||s[e.url]<n)&&(s[e.url]=1+~~s[e.url],t(e))):t(e)}),(o=a,function(e,t){me((function(n){o.extendBean("netType",n),t(e)}))}),function(e,t){a.lifeCycle.emit("beforeReportSpeed",e);var n=a.config.beforeReportSpeed;if((e="function"==typeof n?e.filter((function(e){var t,o,i=!1!==n(e);return"fetch"===e.type&&void 0===e.ret&&e.payload&&(t=(o=g(e.payload.data.response,a.config.api,{url:e.payload.data.url,ctx:e.payload.data})||{}).code,o=o.isErr,e.ret=t,e.isErr=+o),i})):e).length)return t(e)},function(e){return a.sendPipeline([function(e,t){var n,o,r,s;t({type:v.SPEED,url:""+a.config.speedUrl,method:"post",data:(t=e,n=a.bean,r={fetch:[],static:[]},s=new FormData,Array.isArray(t)?t.forEach((function(e){var t=Q(e);r[e.type].push(t)})):(o=Q(t),r[t.type].push(o)),s.append("payload",S(i({duration:r},n))),s),log:e})}],v.SPEED)(e)}]),e.asyncPlugin=!0;try{"undefined"!=typeof document&&(e.uin=e.uin||(null!=(t=document.cookie.match(/\buin=\D+(\d*)/))?t:[])[1]||(null!=(n=document.cookie.match(/\bilive_uin=\D*(\d+)/))?n:[])[1]||""),a.init(e),a.extendBean("sessionId",Xe.sessionID),a.extendBean("from",encodeURIComponent(e.pageUrl||location.href)),"undefined"!=typeof document&&a.extendBean("referer",encodeURIComponent(document.referrer||"")),e.ext1&&a.extendBean("ext1",encodeURIComponent(e.ext1)),e.ext2&&a.extendBean("ext2",encodeURIComponent(e.ext2)),e.ext3&&a.extendBean("ext3",encodeURIComponent(e.ext3))}catch(e){console.warn(e),console.log("%cThe above error occurred in the process of initializing Aegis, which will affect your normal use of Aegis.\nIt is recommended that you contact us for feedback and thank you for your support.","color: red"),a.sendSDKError(e)}return a}function Je(){this.constructor=je}function $e(e){return-1!==Qe.indexOf(e)}new J({name:"ie"});var Qe=window.navigator.userAgent.toLowerCase(),Ke={},Ye=(Ke.macos=function(){return $e("mac")},Ke.ios=function(){return Ke.iphone()||Ke.ipod()||Ke.ipad()},Ke.iphone=function(){return!Ke.windows()&&$e("iphone")},Ke.ipod=function(){return $e("ipod")},Ke.ipad=function(){var e="MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;return $e("ipad")||e},Ke.android=function(){return!Ke.windows()&&$e("android")},Ke.androidPhone=function(){return Ke.android()&&$e("mobile")},Ke.androidTablet=function(){return Ke.android()&&!$e("mobile")},Ke.blackberry=function(){return $e("blackberry")||$e("bb10")},Ke.blackberryPhone=function(){return Ke.blackberry()&&!$e("tablet")},Ke.blackberryTablet=function(){return Ke.blackberry()&&$e("tablet")},Ke.windows=function(){return $e("windows")},Ke.windowsPhone=function(){return Ke.windows()&&$e("phone")},Ke.windowsTablet=function(){return Ke.windows()&&$e("touch")&&!Ke.windowsPhone()},Ke.fxos=function(){return($e("(mobile")||$e("(tablet"))&&$e(" rv:")},Ke.fxosPhone=function(){return Ke.fxos()&&$e("mobile")},Ke.fxosTablet=function(){return Ke.fxos()&&$e("tablet")},Ke.meego=function(){return $e("meego")},Ke.cordova=function(){return window.cordova&&"file:"===location.protocol},Ke.nodeWebkit=function(){return"object"==typeof window.process},Ke.mobile=function(){return Ke.androidPhone()||Ke.iphone()||Ke.ipod()||Ke.windowsPhone()||Ke.blackberryPhone()||Ke.fxosPhone()||Ke.meego()},Ke.tablet=function(){return Ke.ipad()||Ke.androidTablet()||Ke.blackberryTablet()||Ke.windowsTablet()||Ke.fxosTablet()},Ke.desktop=function(){return!Ke.tablet()&&!Ke.mobile()},new J({name:"onClose"}),new J({name:"onClose",onNewAegis:function(){var e,t=this;Ke.desktop()?(e=window.onunload,window.onunload=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];t.publishNotReportedLog(),null!=e&&e.call.apply(e,r([window],n))}):j(this.publishNotReportedLog.bind(this),!0)},publishNotReportedLog:function(){var e=this;this.$walk((function(t){t.sendNow=!0,t.publishPluginsLogs(),t.publishLogsQueue(),e.publishThrottlePipeLogs(t)}))},publishThrottlePipeLogs:function(e){null!=e&&e.speedLogPipeline([]),null!=e&&e.eventPipeline([]),null!=e&&e.customTimePipeline([]),null!=e&&e.normalLogPipeline([])}}));return We.use(Ee),We.use(ne),We.use(Y),We.use(Oe),We.use(He),We.use($),We.use(ge),We.use(X),We.use(Ge),We.use(Ye),We}()},function(e,t,n){"use strict";n.r(t),n.d(t,"AegisReport",(function(){return s}));var o=n(0),i=n.n(o);function r(e){if(window.performance&&window.performance.timing)for(const t in window.performance.timing)if("navigationStart"!==t){let n=window.performance.timing[t]-window.performance.timing.navigationStart;Number.isNaN(n)||(n<0&&(n=0),e.reportTime(t,n))}}function s(e){const t={reportApiSpeed:!0,reportAssetSpeed:!0,beforeRequest:function(e){return(!e.logType||"log"!==e.logType||(t=e.logs.msg,!["oth.str.beacon.qq.com","otheve.beacon.qq.com","h.trace.qq.com/kv","q-ui.cdn-go.cn/qq-theme"].some((function(e){return t.indexOf(e)>-1}))))&&(window.g_aegis&&e.logType&&"performance"===e.logType&&e.logs.firstScreenTiming>1200&&window.g_aegis.infoAll({msg:"QPAGE_PERFORMANCE_SLOW",ext1:"firstScreenTiming: "+e.logs.firstScreenTiming,ext2:"",ext3:"",trace:""}),e);var t}};"number"==typeof e?t.id=e:"string"!=typeof e||Number.isNaN(Number(e))?"string"==typeof e?t.id=e:"object"==typeof e&&Object.assign(t,e):t.id=Number(e);const n=new i.a(t);let o=null;return window.addEventListener("load",()=>{clearTimeout(o),setTimeout(()=>{r(n)},1e3)}),o=setTimeout(()=>{r(n)},3e3),n}t.default=s}])}));